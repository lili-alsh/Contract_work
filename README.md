# Contract_work
Необходимо обновлять реестр рамочных договоров с поставщиками и всех договоров с покупателями, оставляя только действующие на текущий момент договоры. 
## Входные данные
1. Выгрузка договоров.xlsx - файл, содержащий перечень договоров, по которым заполнены данные в 1С. 
В 1С заводится подобным образом карточка договора
![Screenshot](Карточка_договора.jpg)
Также заполняются дополнительно вкладки:
    1. "Основные": сумма проставляется только в разовых договорах или договорах, по которым предусмотрено заключений дополнений к договорам (спецификаций, приложений и т.д.)
    ![Screenshot](Основные.jpg)
    2. "Дополнительно": описание работ заполняется только для разовых договоров
    ![Screenshot](Дополнительно.jpg)
    3. "Условия оплаты":
        1. вид события выбирается из справочника
        2. кол-во дней после выполнения и тип дней заполняются всегда, за исключением, если выбран вид события - Расчет по графику платежей, Предоплата/Расчет до конкретной даты
        3. сумма или процент - взаимоисключающие поля, заполняется что-то одно
        4. комментарий заполняется 2 видами: Оплата по договору либо Спецификация / Приложение/ Заявка необходимы
        ![Screenshot](Условия_оплаты.jpg)
    
Для того, чтобы выгрузить все заполненные данные по договорам, можно использовать Универсальный отчет из 1С. Настройки приведены ниже.
![Screenshot](универсальный_отчет.jpg)
2. ОСВ 60.xlsx
3. ОСВ 62.xlsx
4. ОСВ 76.xlsx
5. 
## Техника решения
### Проверка заполнения
Вначале необходимо убедиться, что все поля заполнены правильно. Поэтому данная часть кода позволяет:
1. проверить заполнены ли столбцы *Тип договора*, *Предмет договора*, *Комментарий*, *Стадия договора*, 
```
(data[fields[2]].isna()) | (data[fields[6]].isna()))|
(data[fields[18]].isna()) | (data[fields[19]].isna())
```        
2. заполнено ли какое-либо из полей *Срок действия* или *Вид расчетов*
```
((~data[fields[10]].isna()) & (~data[fields[11]].isna()))
```
3. кол-во дней должно быть заполнено, только если видом события не является один из трех: Расчет по графику платежей, Предоплата/Расчет до конкретной даты
```
((~data[fields[13]].isin(type_pmnt_sched)) & (~data[fields[13]].isin(type_pmnt_to_date)) 
& (data[fields[14]].isna()))
```
4. при выборе вида события -  Предоплата/Расчет до конкретной даты должна быть заполнены *Дата выполнения*
```
((data[fields[13]].isin(type_pmnt_to_date)) & (data[fields[20]].isna()))
```
5. одно из полей *Дата выполнения* или *Кол-во дней после выполнения* должно быть заполнено
```
((~data[fields[14]].isna()) & (~data[fields[20]].isna()))
```
6. одно из полей *Сумма* или *Процент* должно быть заполнено, только если видом события не является Расчет по графику платежей
```
((data[fields[16]].isna()) & (data[fields[17]].isna()) & (~data[fields[13]].isin(type_pmnt_sched)))|
((~data[fields[16]].isna()) & (~data[fields[17]].isna()))
```
7.сумма не должна равняться 10 (для ввода условий оплаты 1С требует заполнить поле *Сумма*, поэтому общим маркером принято считать цифру 10 - как обозначающую, что сумму заполнили только для заполнения дальнейших полей), которую ввиду человеческого фактора иногда можно забыть убрать
```
(data[fields[7]] == 10)
```
8. *Комментарий* должен быть заполнен либо как Оплата по договору либо Спецификация / Приложение/ Заявка необходимы, ввиду того, что она заполняется вручную, возможны ошибки
```
(~data[fields[18]].isin(req_adds))
```
### Автоматическое закрытие старых договоров
